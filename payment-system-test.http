### ğŸª ë£¨í”„íŒ© BE L2 - ê²°ì œì‹œìŠ¤í…œ API í…ŒìŠ¤íŠ¸
### ì™¸ë¶€ PG ì—°ë™ ë° Resilience íŒ¨í„´ì´ ì ìš©ëœ ê²°ì œì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
@commerce_base_url = http://localhost:8080
@pg_base_url = http://localhost:8082
@user_id = test-user-1

###
### ğŸ“‹ ì‚¬ì „ ì¤€ë¹„ - í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± (DBì—ì„œ ì‹¤í–‰)
### 
### ë‹¤ìŒ SQLì„ DBì— ë¨¼ì € ì‹¤í–‰í•˜ì„¸ìš”:
###
### -- ë¸Œëœë“œ ìƒì„±
### INSERT INTO brand (id, name, created_at, updated_at) 
### VALUES (1, 'ì‚¼ì„±', NOW(), NOW());
### 
### -- ìƒí’ˆ ìƒì„±  
### INSERT INTO product (id, name, value, quantity, brand_id, likes_count, created_at, updated_at)
### VALUES (1, 'ê°¤ëŸ­ì‹œ S24', 1200000, 100, 1, 0, NOW(), NOW());
###
### -- ì‚¬ìš©ì ìƒì„±
### INSERT INTO `user` (id, user_id, `value`, gender, created_at, updated_at)
### VALUES (1, 'test-user-1', 'TestUser1', 'MALE', NOW(), NOW());
### 
### -- í¬ì¸íŠ¸ ìƒì„±
### INSERT INTO point (user_id, point_balance)
### VALUES ('test-user-1', 5000000);

###
### ğŸª Commerce API í…ŒìŠ¤íŠ¸
###

### 1. ì£¼ë¬¸ ìƒì„± (ê²°ì œ ìë™ ìƒì„± + PG í˜¸ì¶œ)
# @no-cookie-jar
POST {{commerce_base_url}}/api/v1/orders
Content-Type: application/json
X-USER-ID: {{user_id}}

{
  "items": [
    {
      "productId": 1,
      "quantity": 1
    }
  ]
}

###
### 2. ì£¼ë¬¸ ì¡°íšŒ
GET {{commerce_base_url}}/api/v1/orders
X-USER-ID: {{user_id}}

###
### 3. íŠ¹ì • ì£¼ë¬¸ ì¡°íšŒ (orderId ìˆ˜ì • í•„ìš”)
GET {{commerce_base_url}}/api/v1/orders/1
X-USER-ID: {{user_id}}

###
### 4. ê²°ì œ ì½œë°± - ì„±ê³µ
POST {{commerce_base_url}}/api/v1/payments/callback
Content-Type: application/json

{
  "transactionId": "TXN-SUCCESS-12345",
  "orderId": "1",
  "status": "SUCCESS",
  "message": "ê²°ì œ ì„±ê³µ"
}

###
### 5. ê²°ì œ ì½œë°± - ì‹¤íŒ¨
POST {{commerce_base_url}}/api/v1/payments/callback
Content-Type: application/json

{
  "transactionId": "TXN-FAILED-67890",
  "orderId": "2", 
  "status": "FAILED",
  "message": "ì¹´ë“œ í•œë„ ì´ˆê³¼"
}

###
###
### ğŸ¦ PG Simulator í…ŒìŠ¤íŠ¸  
###

### 1. ê²°ì œ ìš”ì²­ - ì„±ê³µ ì¼€ì´ìŠ¤ (60% í™•ë¥ )
POST {{pg_base_url}}/api/v1/payments
Content-Type: application/json
X-USER-ID: {{user_id}}

{
  "orderId": "ORDER-TEST-001",
  "cardType": "SAMSUNG",
  "cardNo": "1234-5678-9012-3456",
  "amount": 1200000,
  "callbackUrl": "{{commerce_base_url}}/api/v1/payments/callback"
}

###
### 2. ê²°ì œ ìš”ì²­ - ì—¬ëŸ¬ ë²ˆ í…ŒìŠ¤íŠ¸ (ëœë¤ ê²°ê³¼)
POST {{pg_base_url}}/api/v1/payments
Content-Type: application/json
X-USER-ID: {{user_id}}

{
  "orderId": "ORDER-TEST-002",
  "cardType": "SAMSUNG", 
  "cardNo": "1234-5678-9012-3456",
  "amount": 500000,
  "callbackUrl": "{{commerce_base_url}}/api/v1/payments/callback"
}

###
### 3. ê±°ë˜ ìƒì„¸ ì¡°íšŒ (transactionKey ìˆ˜ì • í•„ìš”)
GET {{pg_base_url}}/api/v1/payments/20250821:TR:abcdef
X-USER-ID: {{user_id}}

###
### 4. ì£¼ë¬¸ë³„ ê±°ë˜ ì¡°íšŒ  
GET {{pg_base_url}}/api/v1/payments?orderId=ORDER-TEST-001
X-USER-ID: {{user_id}}

###
###
### ğŸ›¡ï¸ Resilience íŒ¨í„´ í…ŒìŠ¤íŠ¸
###

### 1. ì„œí‚·ë¸Œë ˆì´ì»¤ í…ŒìŠ¤íŠ¸ - ì—°ì† ìš”ì²­ (ì´ê±¸ ë¹ ë¥´ê²Œ 10ë²ˆ ì‹¤í–‰)
POST {{pg_base_url}}/api/v1/payments
Content-Type: application/json
X-USER-ID: {{user_id}}

{
  "orderId": "CIRCUIT-TEST-{{$random.integer(1000, 9999)}}",
  "cardType": "SAMSUNG",
  "cardNo": "1234-5678-9012-3456", 
  "amount": 10000,
  "callbackUrl": "{{commerce_base_url}}/api/v1/payments/callback"
}

###
### 2. ì¬ì‹œë„ í…ŒìŠ¤íŠ¸ - PG ì§€ì—° í™•ì¸
POST {{pg_base_url}}/api/v1/payments
Content-Type: application/json
X-USER-ID: {{user_id}}

{
  "orderId": "RETRY-TEST-{{$random.integer(1000, 9999)}}",
  "cardType": "SAMSUNG",
  "cardNo": "1234-5678-9012-3456",
  "amount": 20000,
  "callbackUrl": "{{commerce_base_url}}/api/v1/payments/callback"
}

###
###
### ğŸ”„ ì „ì²´ ê²°ì œ í”Œë¡œìš° í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
###

### ì‹œë‚˜ë¦¬ì˜¤ 1: ì •ìƒ ê²°ì œ ì™„ë£Œ
### Step 1: ì£¼ë¬¸ ìƒì„±
POST {{commerce_base_url}}/api/v1/orders
Content-Type: application/json
X-USER-ID: test-user-scenario1

{
  "items": [
    {
      "productId": 1,
      "quantity": 1
    }
  ]
}

### Step 2: ìˆ˜ë™ PG ê²°ì œ (ì‹¤ì œ í™˜ê²½ì—ì„œëŠ” ìë™)
POST {{pg_base_url}}/api/v1/payments  
Content-Type: application/json
X-USER-ID: test-user-scenario1

{
  "orderId": "1",
  "cardType": "SAMSUNG",
  "cardNo": "1234-5678-9012-3456",
  "amount": 1200000,
  "callbackUrl": "{{commerce_base_url}}/api/v1/payments/callback"
}

### Step 3: ê²°ì œ ì„±ê³µ ì½œë°±
POST {{commerce_base_url}}/api/v1/payments/callback
Content-Type: application/json

{
  "transactionId": "SCENARIO1-SUCCESS",
  "orderId": "1", 
  "status": "SUCCESS",
  "message": "ê²°ì œ ì„±ê³µ"
}

###
### ì‹œë‚˜ë¦¬ì˜¤ 2: ê²°ì œ ì‹¤íŒ¨
### Step 1: ì£¼ë¬¸ ìƒì„±
POST {{commerce_base_url}}/api/v1/orders
Content-Type: application/json
X-USER-ID: test-user-scenario2

{
  "items": [
    {
      "productId": 1,
      "quantity": 1  
    }
  ]
}

### Step 2: ê²°ì œ ì‹¤íŒ¨ ì½œë°±
POST {{commerce_base_url}}/api/v1/payments/callback
Content-Type: application/json

{
  "transactionId": "SCENARIO2-FAILED",
  "orderId": "2",
  "status": "FAILED", 
  "message": "ì¹´ë“œ í•œë„ ì´ˆê³¼"
}

###
### ğŸ¯ Round 7 Quest - ApplicationEvent í…ŒìŠ¤íŠ¸
###

### ğŸ“‹ ì´ë²¤íŠ¸ ê¸°ë°˜ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸

### 1. ìƒí’ˆ ì¢‹ì•„ìš” (ì´ë²¤íŠ¸ ë¶„ë¦¬: ì¢‹ì•„ìš” ë“±ë¡ vs ì§‘ê³„ ì—…ë°ì´íŠ¸)
POST {{commerce_base_url}}/api/v1/products/1/likes
Content-Type: application/json
X-USER-ID: {{user_id}}

{}

###
### 2. ìƒí’ˆ ì¢‹ì•„ìš” ì·¨ì†Œ (eventual consistency í…ŒìŠ¤íŠ¸)
DELETE {{commerce_base_url}}/api/v1/products/1/likes
Content-Type: application/json
X-USER-ID: {{user_id}}

###
### 3. ìƒí’ˆ ì¡°íšŒ (ì‚¬ìš©ì í–‰ë™ ì¶”ì  ì´ë²¤íŠ¸)
GET {{commerce_base_url}}/api/v1/products/1
X-USER-ID: {{user_id}}

###
### 4. ìƒí’ˆ ëª©ë¡ ì¡°íšŒ (ì‚¬ìš©ì í–‰ë™ ì¶”ì )
GET {{commerce_base_url}}/api/v1/products
X-USER-ID: {{user_id}}

###
### ğŸ¯ ì£¼ë¬¸-ê²°ì œ ì´ë²¤íŠ¸ ë¶„ë¦¬ í…ŒìŠ¤íŠ¸

### 1. ì¿ í° í¬í•¨ ì£¼ë¬¸ ìƒì„± (ì´ë²¤íŠ¸ ë¶„ë¦¬: ì£¼ë¬¸ ìƒì„± â†’ ì¿ í° ì‚¬ìš© â†’ ê²°ì œ â†’ ë°ì´í„° í”Œë«í¼)
POST {{commerce_base_url}}/api/v1/orders
Content-Type: application/json
X-USER-ID: {{user_id}}

{
  "items": [
    {
      "productId": 1,
      "quantity": 1
    }
  ],
  "couponId": null
}

###
### 2. ì£¼ë¬¸ ìƒì„± í›„ ìƒíƒœ ë³€í™” í™•ì¸ (PENDING â†’ COMPLETED/PAYMENT_FAILED)
GET {{commerce_base_url}}/api/v1/orders
X-USER-ID: {{user_id}}

###
### ğŸ”„ ê²°ì œ ì‹¤íŒ¨ â†’ PAYMENT_FAILED ìƒíƒœ í…ŒìŠ¤íŠ¸

### 1. ê²°ì œ ì‹¤íŒ¨ ì‹œë®¬ë ˆì´ì…˜
POST {{commerce_base_url}}/api/v1/payments/callback
Content-Type: application/json

{
  "transactionId": "TXN-FAILED-TEST",
  "orderId": "1",
  "status": "FAILED",
  "message": "ê²°ì œ ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸"
}

###
### 2. PAYMENT_FAILED ìƒíƒœ í™•ì¸
GET {{commerce_base_url}}/api/v1/orders/1

###
### ğŸ” ìƒíƒœ í™•ì¸ ë° ëª¨ë‹ˆí„°ë§
###

### 1. ì‚¬ìš©ì ì£¼ë¬¸ ëª©ë¡
GET {{commerce_base_url}}/api/v1/orders
X-USER-ID: {{user_id}}

###
### 2. íŠ¹ì • ì£¼ë¬¸ ìƒíƒœ
GET {{commerce_base_url}}/api/v1/orders/1

###
### 3. PG ì‹œë®¬ë ˆì´í„° ìƒíƒœ (ë¹„ê³µì‹)
GET {{pg_base_url}}/

###
###
### ğŸ“Š ì„±ëŠ¥ ë° ë¶€í•˜ í…ŒìŠ¤íŠ¸
###

### ë™ì‹œì„± í…ŒìŠ¤íŠ¸ - ì´ê±¸ ì—¬ëŸ¬ íƒ­ì—ì„œ ë™ì‹œ ì‹¤í–‰
POST {{commerce_base_url}}/api/v1/orders
Content-Type: application/json
X-USER-ID: concurrent-user-{{$random.integer(1, 100)}}

{
  "items": [
    {
      "productId": 1,
      "quantity": 1
    }
  ]
}

### 
### ğŸš¨ ì¥ì•  ì‹œë®¬ë ˆì´ì…˜
### 

### PG ì„œë²„ ë‹¤ìš´ ì‹œë®¬ë ˆì´ì…˜ - PG ì„œë²„ ì¢…ë£Œ í›„ ì‹¤í–‰
POST {{commerce_base_url}}/api/v1/orders
Content-Type: application/json
X-USER-ID: failover-test

{
  "items": [
    {
      "productId": 1,
      "quantity": 1
    }
  ]
}

###
### ğŸ“ í…ŒìŠ¤íŠ¸ ê²°ê³¼ í™•ì¸ í¬ì¸íŠ¸:
###
### âœ… ì£¼ë¬¸ ìƒì„± ì‹œ Payment ì—”í‹°í‹°ë„ í•¨ê»˜ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸
### âœ… PG í˜¸ì¶œì´ ì‹¤ì œë¡œ ì´ë£¨ì–´ì§€ëŠ”ì§€ ë¡œê·¸ í™•ì¸  
### âœ… íƒ€ì„ì•„ì›ƒ ë°œìƒ ì‹œ PENDING ìƒíƒœë¡œ ìœ ì§€ë˜ëŠ”ì§€ í™•ì¸
### âœ… ì„œí‚·ë¸Œë ˆì´ì»¤ ì‘ë™ ì‹œ ì¦‰ì‹œ í´ë°± ì‘ë‹µí•˜ëŠ”ì§€ í™•ì¸
### âœ… ì½œë°± ì²˜ë¦¬ ì‹œ Paymentì™€ Order ìƒíƒœ ë™ê¸°í™” í™•ì¸
### âœ… ìŠ¤ì¼€ì¤„ëŸ¬ê°€ PENDING ê²°ì œë¥¼ ë³µêµ¬í•˜ëŠ”ì§€ í™•ì¸ (5ë¶„ ëŒ€ê¸°)
###
### ğŸ¯ Round 7 Quest í™•ì¸ í¬ì¸íŠ¸:
### âœ… ì¢‹ì•„ìš” ë“±ë¡ì€ ì¦‰ì‹œ ì™„ë£Œ, ì§‘ê³„ëŠ” ë¹„ë™ê¸°ë¡œ ì²˜ë¦¬ë˜ëŠ”ì§€ í™•ì¸
### âœ… ì§‘ê³„ ì‹¤íŒ¨í•´ë„ ì¢‹ì•„ìš”ëŠ” ì •ìƒ ì™„ë£Œë˜ëŠ”ì§€ í™•ì¸ (eventual consistency)
### âœ… ì£¼ë¬¸ ìƒì„± í›„ ì¿ í° ì‚¬ìš©, ê²°ì œ, ë°ì´í„° í”Œë«í¼ ì „ì†¡ì´ ë³„ë„ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ”ì§€ í™•ì¸
### âœ… ì‚¬ìš©ì í–‰ë™ ì¶”ì  ì´ë²¤íŠ¸ê°€ ë¹„ë™ê¸°ë¡œ ë¡œê¹…ë˜ëŠ”ì§€ í™•ì¸
### âœ… ê²°ì œ ì‹¤íŒ¨ ì‹œ PAYMENT_FAILED ìƒíƒœë¡œ ë³€ê²½ë˜ëŠ”ì§€ í™•ì¸ (ì´ì „ì—” PENDING ìœ ì§€)
### âœ… PaymentRecoverySchedulerê°€ PAYMENT_FAILED ì£¼ë¬¸ì„ ì¬ì‹œë„í•˜ì§€ ì•ŠëŠ”ì§€ í™•ì¸
### 
### ğŸ¯ ì„±ê³µ ê¸°ì¤€:
### - ì£¼ë¬¸ ìƒì„±: PENDING ìƒíƒœë¡œ ìƒì„±
### - ê²°ì œ ì„±ê³µ: PENDING â†’ COMPLETED
### - ê²°ì œ ì‹¤íŒ¨: PENDING â†’ PAYMENT_FAILED (NEW!)
### - PG ì—°ë™: ì‹¤ì œ API í˜¸ì¶œ ë° ì‘ë‹µ ì²˜ë¦¬
### - ì´ë²¤íŠ¸ ë¶„ë¦¬: ë©”ì¸ ë¡œì§ê³¼ ë¶€ê°€ ë¡œì§ì´ ë…ë¦½ì ì¸ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ì‹¤í–‰
### - Resilience: ì¥ì•  ìƒí™©ì—ì„œë„ ì‹œìŠ¤í…œ ì•ˆì •ì„± ìœ ì§€
### - Eventual Consistency: ì¢‹ì•„ìš” ì§‘ê³„ê°€ ìµœì¢…ì ìœ¼ë¡œ ì¼ê´€ì„±ì„ ë§ì¶”ëŠ”ì§€ í™•ì¸
###